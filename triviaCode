Option Explicit

' Variables to store the slide numbers of the first and last slides of each section
Dim easyBegin As Integer, easyEnd As Integer, mediumBegin As Integer, mediumEnd As Integer, hardBegin As Integer, hardEnd As Integer, lotteryBegin As Integer, lotteryEnd As Integer
' Variables to store the slide numbers of the award-points slides for both teams
Dim birdsOne As Integer, birdsTwo As Integer, birdsThree As Integer, pigsOne As Integer, pigsTwo As Integer, pigsThree As Integer
' Variables to store the slide numbers of key slides
Dim gameboard As Integer, lottery As Integer
' Variables to handle transitions and animations
Dim chosenSlide As Integer, chosenShape As String, chosenLottery As String

Dim alreadyShownSlides() As Boolean

Sub StartGame()
    ' Set the current slide numbers for the gameboard and points slides
    FindGameboardAndPointsSlides
    
    ' Delete leftover "Question ID" textboxes on trivia slides and reset the scoreboards to 0
    ResetGame
    
    ' Create arrays to keep track of which questions and lottery events have already been shown this game
    CreateSlidesArrays
    
    ' Proceed to the next slide
    SlideShowWindows(1).View.Next
    
End Sub

Private Sub FindGameboardAndPointsSlides()
    Dim sld As Slide
    
    For Each sld In ActivePresentation.Slides
        If sld.SlideID >= 259 And sld.SlideID <= 272 Then
            If sld.SlideID = 259 Then
                gameboard = sld.slideIndex
            ElseIf sld.SlideID = 260 Then
                birdsOne = sld.slideIndex
            ElseIf sld.SlideID = 262 Then
                birdsTwo = sld.slideIndex
            ElseIf sld.SlideID = 264 Then
                birdsThree = sld.slideIndex
            ElseIf sld.SlideID = 266 Then
                pigsOne = sld.slideIndex
            ElseIf sld.SlideID = 268 Then
                pigsTwo = sld.slideIndex
            ElseIf sld.SlideID = 270 Then
                pigsThree = sld.slideIndex
            ElseIf sld.SlideID = 272 Then
                lottery = sld.slideIndex
            End If
        End If
    Next sld
End Sub

Private Sub ResetGame()
    Dim sld As Slide, shp As Shape
    
    For Each sld In ActivePresentation.Slides ' Loop through all slides
        For Each shp In sld.Shapes ' Loop through all shapes on the slide
            If shp.Name = "QuestionID" Then ' Check if shape name is "QuestionID"
                shp.Delete ' Delete the shape
            End If
        Next shp
    Next sld
    
    ' Reset the scoreboards to 0
    ActivePresentation.Slides(gameboard).Shapes("Birds_Scoreboard").TextFrame.TextRange.Text = 0
    ActivePresentation.Slides(gameboard).Shapes("Pigs_Scoreboard").TextFrame.TextRange.Text = 0
End Sub

Private Sub CreateSlidesArrays()
    Dim sld As Slide, secIndex As Integer, secStart() As Integer, secEnd() As Integer
    ReDim secStart(1 To ActivePresentation.SectionProperties.Count)
    ReDim secEnd(1 To ActivePresentation.SectionProperties.Count)

    For Each sld In ActivePresentation.Slides
        secIndex = sld.sectionIndex
        If secStart(secIndex) = 0 Or sld.slideIndex < secStart(secIndex) Then
            secStart(secIndex) = sld.slideIndex
        End If
        If sld.slideIndex > secEnd(secIndex) Then
            secEnd(secIndex) = sld.slideIndex
        End If
    Next sld

    Dim i As Integer

    For i = 1 To ActivePresentation.SectionProperties.Count
        If ActivePresentation.SectionProperties.Name(i) = "Easy Questions" Then
            easyBegin = secStart(i)
            easyEnd = secEnd(i)
        ElseIf ActivePresentation.SectionProperties.Name(i) = "Medium Questions" Then
            mediumBegin = secStart(i)
            mediumEnd = secEnd(i)
        ElseIf ActivePresentation.SectionProperties.Name(i) = "Hard Questions" Then
            hardBegin = secStart(i)
            hardEnd = secEnd(i)
        ElseIf ActivePresentation.SectionProperties.Name(i) = "Lottery Events" Then
            lotteryBegin = secStart(i)
            lotteryEnd = secEnd(i)
        End If
    Next i
    
    ' Loop through each slide and store slide numbers for slides in Easy Questions, Medium Questions, and Hard Questions sections in slideNumbers
    ' and store the slide numbers for the slides in Lottery Events in lotteryNumbers
    ReDim alreadyShownSlides(1 To ActivePresentation.Slides.Count)
    Dim j As Integer
    For j = 1 To ActivePresentation.Slides.Count
        If j >= easyBegin And j <= easyEnd Or j >= mediumBegin And j <= mediumEnd Or j >= hardBegin And j <= hardEnd Or j >= lotteryBegin And j <= lotteryEnd Then
            alreadyShownSlides(j) = False
        End If
    Next j

End Sub

Sub Easy(clickedShp As Shape)
    ' Record the name of the clicked shape so that it can be removed after returning to the gameboard
    chosenShape = clickedShp.Name
    
    ChooseSlide easyBegin, easyEnd
End Sub

Sub Medium(clickedShp As Shape)
    ' Declare variable and initialize the values of the first and final question for this difficulty
    chosenShape = clickedShp.Name
    
    ChooseSlide mediumBegin, mediumEnd
End Sub

Sub Hard(clickedShp As Shape)
    ' Declare variable and initialize the values of the first and final question for this difficulty
    chosenShape = clickedShp.Name
    
    ChooseSlide hardBegin, hardEnd
End Sub

Sub EasyAndMedium(clickedShp As Shape)
    ' Declare variable and initialize the values of the first and final question for this difficulty
    chosenShape = clickedShp.Name
    
    ChooseSlide easyBegin, mediumEnd
End Sub

Sub MediumAndHard(clickedShp As Shape)
    ' Declare variable and initialize the values of the first and final question for this difficulty
    chosenShape = clickedShp.Name
    
    ChooseSlide mediumBegin, hardEnd
End Sub

Sub All(clickedShp As Shape)
    ' Declare variable and initialize the values of the first and final question for this difficulty
    chosenShape = clickedShp.Name
    
    ChooseSlide easyBegin, hardEnd
End Sub

Sub ToLottery(clickedShp As Shape)
    Dim sld As Slide
    
    chosenShape = clickedShp.Name
    
    SlideShowWindows(1).View.GotoSlide (lottery)
    
    Set sld = SlideShowWindows(1).View.Slide
    
    For Each shp In sld.Shapes
        If shp.Name = chosenLottery Then
            shp.AnimationSettings.EntryEffect = ppEffectRandomBarsHorizontal
            shp.AnimationSettings.AfterEffect = ppAfterEffectDim
            Exit For
        End If
    Next shp
End Sub

Sub ToEvent(clickedShp As Shape)
    sld As Slide
    
    chosenLottery = clickedShp.Name
    
    Do
        chosenSlide = RandBetween(lotteryBegin, lotteryEnd)
    Loop While alreadyShownSlides(chosenSlide)
    
    alreadyShownSlides(chosenSlide) = True
    
    SlideShowWindows(1).View.GotoSlide (chosenSlide)
End Sub

Private Sub ChooseSlide(lowestSlide As Integer, highestSlide As Integer)
    Dim sld As Slide
    
    ' Pick a random slide until we find one that has not been shown yet
    Do
        chosenSlide = RandBetween(lowestSlide, highestSlide) ' Randomly choose a slide between the given values
    Loop While alreadyShownSlides(chosenSlide) ' If this is logically true, then it will loop until false
    
    alreadyShownSlides(chosenSlide) = True ' Set this slide as chosen so that it doesn't appear again
    
    Set sld = ActivePresentation.Slides(chosenSlide)
    
    Dim sldWidth As Long
    sldWidth = sld.Master.Width
    Dim tbWidth As Long
    tbWidth = 105
    Dim tbLeft As Long
    tbLeft = sldWidth - (tbWidth)
    
    SlideShowWindows(1).View.GotoSlide (chosenSlide)
    
    With sld.Shapes.AddTextbox(msoOrientationHorizontal, tbLeft, 0, 105, 124)
        .Name = "QuestionID"
        .TextFrame.TextRange.Text = clickedShp.Name
        .TextFrame.TextRange.Font.Name = "Feast of Flesh BB"
        .TextFrame.TextRange.Font.Size = 96
        .TextFrame.TextRange.Font.Color.RGB = RGB(0, 0, 0)
        .TextFrame.TextRange.Font.Bold = msoTrue
        .TextFrame.TextRange.Font.Italic = msoTrue
        .TextFrame.TextRange.Paragraphs.ParagraphFormat.Alignment = ppAlignCenter
    End With
End Sub

Function RandBetween(vLow As Integer, vHigh As Integer)
    Randomize
    RandBetween = Int(vLow + (vHigh - vLow + 1) * Rnd())
End Function

Sub ReturnToGameboard()
    Dim shp As Shape, sld As Slide
    
    Set sld = SlideShowWindows(1).View.Slide
    For Each shp In sld.Shapes
        If shp.Name = "QuestionID" Then
            shp.Delete
            Exit For
        End If
    Next shp
    
    SlideShowWindows(1).View.GotoSlide (gameboard)
End Sub

Sub AwardPigs()
    If ActivePresentation.SlideShowWindow.View.Slide.SlideNumber >= easyBegin And ActivePresentation.SlideShowWindow.View.Slide.SlideNumber <= easyEnd Then
        ActivePresentation.SlideShowWindow.View.GotoSlide (pigsOne)
    ElseIf ActivePresentation.SlideShowWindow.View.Slide.SlideNumber >= mediumBegin And ActivePresentation.SlideShowWindow.View.Slide.SlideNumber <= mediumEnd Then
        ActivePresentation.SlideShowWindow.View.GotoSlide (pigsTwo)
    ElseIf ActivePresentation.SlideShowWindow.View.Slide.SlideNumber >= hardBegin And ActivePresentation.SlideShowWindow.View.Slide.SlideNumber <= hardEnd Then
        ActivePresentation.SlideShowWindow.View.GotoSlide (pigsThree)
    End If
End Sub

Sub AwardBirds()
    If ActivePresentation.SlideShowWindow.View.Slide.SlideNumber >= easyBegin And ActivePresentation.SlideShowWindow.View.Slide.SlideNumber <= easyEnd Then
        ActivePresentation.SlideShowWindow.View.GotoSlide (birdsOne)
    ElseIf ActivePresentation.SlideShowWindow.View.Slide.SlideNumber >= mediumBegin And ActivePresentation.SlideShowWindow.View.Slide.SlideNumber <= mediumEnd Then
        ActivePresentation.SlideShowWindow.View.GotoSlide (birdsTwo)
    ElseIf ActivePresentation.SlideShowWindow.View.Slide.SlideNumber >= hardBegin And ActivePresentation.SlideShowWindow.View.Slide.SlideNumber <= hardEnd Then
        ActivePresentation.SlideShowWindow.View.GotoSlide (birdsThree)
    End If
End Sub
